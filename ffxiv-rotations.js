$.ajaxSetup({headers:{"Access-Control-Allow-Origin":"*","Sec-Fetch-Site":"same-origin",Origin:"https://ffxivrotations.com/",Referer:"https://ffxivrotations.com/"}});var selectedClassId,selectedClass="Ninja",base="0123456789abcdefghijklmnopqrstuvwxyz";function toURLBase(e){for(var t=base.length,l="";0!=e;)l=base[e%t]+l,e=Math.floor(e/t);return l}function fromURLBase(e){e=e.toLowerCase();for(var t=base.length,l=0,s=1,i=e.length-1;0<=i;i--)l+=base.indexOf(e[i])*s,s*=t;return l}var Skill=function(){function e(){}return e.prototype.displayName=function(){return this.name.replace("{class}",selectedClass)},e.prototype.iconPath=function(){return this.multiIcon?"icons/"+this.icon+(selectedClassId-8)+".png":"icons/"+this.icon+".png"},e.prototype.resourceType=function(){switch(this.category){case 2:return"MP";case 3:return"TP";case 4:return"";case 6:return"GP";case 7:return"CP"}},e.prototype.isCombatantSkill=function(){return 2==this.category||3==this.category||4==this.category||null==this.category},e.prototype.isCrossClassSkill=function(){return-1!=db.classes[selectedClass].cross.indexOf(this.id)},e}();function getSkill(e){var t=new Skill,l=db.skills[e];return t.id=e,t.name=l.name,t.help_html=l.help_html,t.level=l.level,t.cast_time=l.cast_time,t.recast_time=l.recast_time,t.cost=l.cost,t.cast_range=l.cast_range,t.icon=l.icon,t.category=l.category,t.radius=l.radius,t.cross_class_skill=l.cross_class_skill,t.gcd=l.gcd,l.deprecated&&(t.deprecated=!0),l.multiIcon&&(t.multiIcon=!0),t}function hasError(e){return"error"in e}function pluralize(e,t){return 1==t?"1 "+e:t.toString()+" "+e+"s"}function createSkillInfoMouseOver(e,l){e.hover(function(){var t=l;t.isCrossClassSkill()&&null!=t.cross_class_skill&&(t=getSkill(t.cross_class_skill)),$("#skillInfo .skillIcon").attr("src",t.iconPath()),$("#skillName").html(t.displayName()),$("#skillDescription").html(t.help_html);var e=[["Level",null!=t.level,function(){return t.level.toString()}],["Cast",null!=t.cast_time&&t.isCombatantSkill(),function(){return 0==t.cast_time?"Instant":pluralize("second",t.cast_time)}],["Recast",null!=t.recast_time&&t.isCombatantSkill(),function(){return pluralize("second",t.recast_time)}],["Cost",null!=t.cost,function(){return"number"==typeof t.cost?t.cost+" "+t.resourceType():t.cost}],["Range",null!=t.cast_range&&t.isCombatantSkill(),function(){var e=t.cast_range;if(-1==e)switch(selectedClass){case"Bard":case"Machinist":e=25;break;default:e=3}return pluralize("yalm",e)}],["Radius",null!=t.radius&&(2==t.category||3==t.category||4==t.category),function(){return pluralize("yalm",t.radius)}]];$("#skillProperties").empty(),$.each(e,function(e,t){t[1]&&$("#skillProperties").append($("<tr>").append($("<td>").text(t[0]),$("<td>").text(t[2]())))}),$("#skillInfo").slideDown()})}function createSkillDiv(e){var t=getSkill(e),l=$('<div class="skillIcon">');return l.css("background-image","url("+t.iconPath()+")"),l.data("id",e),0==t.gcd&&l.append('<i class="material-icons gcd">replay</i>'),createSkillInfoMouseOver(l,t),l}function createSkillSelectorDiv(e,t){var l=e.displayName(),s=e.level,i=$('<div class="skillSelectorItem">'),l=$('<div class="miniInfo truncate">').html(l+"<br/>Lv. "+(s?s.toString():"any")),s=$('<div class="skillIconContainer">');return s.append(createSkillDiv(e.id)),i.append(s),i.append(l),i}function copySkillDiv(e){return createSkillDiv(e.data("id"))}function applyModel(e){if(null!=e&&0<e.length)for(var t=e.split(","),l=0;l<t.length;l++){var s=createSkillDiv(parseInt(t[l]));$("#sortable").append(s)}updateClassSelect(),updateArrows()}function updateClassSelect(){$("#class").val(selectedClass),$("#class").material_select()}function getSkillSequenceString(){var l=[];return $.each($("#sortable .skillIcon"),function(e,t){l.push($(t).data("id"))}),l.join()}function setVisits(e){-1==e?$("#hits").text("0 views of this skill sequence - share the link!"):$("#hits").text(+e+" views of this skill sequence")}function setModified(e){}function modelUpdate(){setModified(!0),updateArrows();var e=getSkillSequenceString();Cookies.set(selectedClass,e)}function getClassIcon(e){return"classIcons/"+e.replace(/\s/g,"").toLowerCase()+"3.png"}function sortSkillsByLevel(e){e.sort(function(e,t){e=getSkill(e),t=getSkill(t);return e.level-t.level})}function populateSkillSection(l,e){null!=e&&e.length?($(l).parent().parent().show(),sortSkillsByLevel(e),$.each(e,function(e,t){t=getSkill(t);t.deprecated||$(l).append(createSkillSelectorDiv(t,!1))})):$(l).parent().parent().hide()}function populateSkillSelector(){populateSkillSection("#classSkills",db.classes[selectedClass].native),populateSkillSection("#iaijutsuSkills",db.classes[selectedClass].iaijutsu),populateSkillSection("#summonSkills",db.classes[selectedClass].summon),populateSkillSection("#specialistSkills",db.classes[selectedClass].specialist),populateSkillSection("#ninjutsuSkills",db.classes[selectedClass].ninjutsu),populateSkillSection("#stepSkills",db.classes[selectedClass].step),populateSkillSection("#crossClassSkills",db.classes[selectedClass].cross),"hand"!=db.classes[selectedClass].discipline&&"land"!=db.classes[selectedClass].discipline?populateSkillSection("#miscSkills",db.misc):populateSkillSection("#miscSkills",[]),$(".skillSelector .skillIcon").draggable({helper:function(e){return copySkillDiv($(e.target))},connectToSortable:"#sortable",distance:5}),$(".skillSelectorItem").on("click",function(e){$("#sortable").append(copySkillDiv($(this).find(".skillIcon"))),modelUpdate()})}function clearSequence(){$("#sortable").empty()}function updateArrows(){$("#sortable .arrow").remove(),$("#sortable .skillIcon:not(.ui-sortable-helper)").each(function(e,t){}).after($('<div class="arrow">'))}$(function(){$(".modal-trigger").leanModal(),$("#skillInfo").pushpin({top:$("#skillInfo").offset().top}),$("#skillInfo").hide(),$("#clear").click(function(){clearSequence(),modelUpdate()}),$("#share").click(function(){$.get("https://ffxivrotations.com/share.py",{class:selectedClass,sequence:getSkillSequenceString()}).done(function(e){hasError(e)||(history.replaceState({},"","/"+toURLBase(e.id)),setModified(!1),Materialize.toast("URL updated!",6e3),setVisits(e.hits))})}),$("#class").change(function(){selectedClass=$("#class").val(),selectedClassId=db.classes[selectedClass].id,clearSequence();var e=Cookies.get(selectedClass);null!=e&&applyModel(e),$(".skillSelector").empty(),populateSkillSelector(),modelUpdate()});var l=!1;$("#sortable").sortable({items:".skillIcon",placeholder:"skillIcon block-placeholder",distance:5,stop:function(e,t){modelUpdate()},tolerance:"pointer",over:function(){l=!1},out:function(){l=!0},beforeStop:function(e,t){1==l&&t.item.remove()},change:function(e,t){updateArrows()}}),$("#sortable").disableSelection(),$("#sortable").on("click","div",function(e){$(e.target).remove(),modelUpdate()});var e=location.pathname.lastIndexOf("/"),t=(fromURLBase(location.pathname.substring(e+1)),$.getJSON("db.json")),e=$.getJSON("dummy.json");$.when(t,e).done(function(e,t){db=e[0];t=t[0];hasError(t)||(selectedClass=t.class,applyModel(t.sequence),setVisits(t.hits)),console.log("got both data"),populateSkillSelector(),$.each(db.classes,function(e,t){t="#"+t.discipline+"Selector";$(t).append($("<option></option>").attr("value",e).attr("data-icon",getClassIcon(e)).attr("class","left").text(e))}),updateClassSelect()})});